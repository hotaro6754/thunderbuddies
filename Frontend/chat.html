<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ThunderBuddies Chatbot</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; background:#0b1226;color:#e6eef9; }
      .container{max-width:720px;margin:48px auto;padding:24px;background:rgba(255,255,255,0.03);border-radius:12px}
      .messages{height:400px;overflow:auto;padding:12px;border-radius:8px;background:#071020}
      .message{padding:8px 12px;margin:8px 0;border-radius:8px}
      .user{background:#1e90ff;color:white;text-align:right}
      .bot{background:#223344;color:#dbe9ff;text-align:left}
      form{display:flex;gap:8px;margin-top:12px}
      input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
      button{padding:10px 14px;border-radius:8px;border:none;background:#0ea5a4;color:#03111a}
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ThunderBuddies Chatbot</h1>
      <div class="messages" id="messages"></div>
      <form id="chatForm">
        <input id="input" type="text" placeholder="Say hi..." autocomplete="off" />
        <button type="submit">Send</button>
      </form>
    </div>

    <script>
      const form = document.getElementById('chatForm');
      const input = document.getElementById('input');
      const messagesEl = document.getElementById('messages');
      const conversation = [];

      function appendMessage(text, cls){
        const div = document.createElement('div');
        div.className = 'message ' + cls;
        div.textContent = text;
        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;
        appendMessage(text, 'user');
        conversation.push({role:'user', content:text});
        input.value = '';

        appendMessage('...', 'bot');
        try{
          const res = await fetch('/api/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ message: text, conversation }) });
          const data = await res.json();
          // replace last bot message
          const botEls = messagesEl.querySelectorAll('.bot');
          if (botEls.length) botEls[botEls.length-1].textContent = data.reply;
          conversation.push({role:'assistant', content:data.reply});
        }catch(err){
          const botEls = messagesEl.querySelectorAll('.bot');
          if (botEls.length) botEls[botEls.length-1].textContent = 'Error: ' + err.message;
        }
      });
    </script>
  </body>
</html>
